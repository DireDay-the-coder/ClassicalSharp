#ifndef CC_MAP_GEN_H
#define CC_MAP_GEN_H
#include "String.h"
#include "ExtMath.h"
#include "Vectors.h"
/* Implements flatgrass map generator, and original classic vanilla map generation (with perlin noise)
   Based on: https://github.com/UnknownShadow200/ClassicalSharp/wiki/Minecraft-Classic-map-generation-algorithm
   Thanks to Jerralish for originally reverse engineering classic's algorithm, then preparing a high level overview of the algorithm.
   Copyright 2014 - 2017 ClassicalSharp | Licensed under BSD-3
*/

volatile float Gen_CurrentProgress;
volatile const char* Gen_CurrentState;
volatile bool Gen_Done;
int Gen_Width, Gen_Height, Gen_Length, Gen_Seed;
bool Gen_Vanilla;
BlockRaw* Gen_Blocks;
#define Gen_SetDimensions(x, y, z) Gen_Width = x; Gen_Height = y; Gen_Length = z;

void FlatgrassGen_Generate(void);
void NotchyGen_Generate(void);

#define NOISE_TABLE_SIZE 512
void ImprovedNoise_Init(uint8_t* p, RNGState* rnd);
float ImprovedNoise_Calc(uint8_t* p, float x, float y);

struct OctaveNoise { uint8_t p[8][NOISE_TABLE_SIZE]; int octaves; };
void OctaveNoise_Init(struct OctaveNoise* n, RNGState* rnd, int octaves);
float OctaveNoise_Calc(struct OctaveNoise* n, float x, float y);

struct CombinedNoise { struct OctaveNoise noise1, noise2; };
void CombinedNoise_Init(struct CombinedNoise* n, RNGState* rnd, int octaves1, int octaves2);
float CombinedNoise_Calc(struct CombinedNoise* n, float x, float y);


int Tree_Width, Tree_Height, Tree_Length;
BlockRaw* Tree_Blocks;
RNGState* Tree_Rnd;
/* Appropriate buffer size to hold positions and blocks generated by the tree generator. */
#define TREE_MAX_COUNT 96

/* Whether a tree can actually be generated at the given coordinates. */
bool TreeGen_CanGrow(int treeX, int treeY, int treeZ, int treeHeight);
/* Generates the blocks (and their positions in the world) that actually make up a tree. */
/* Returns the number of blocks generated, which will be <= TREE_MAX_COUNT */
int  TreeGen_Grow(int treeX, int treeY, int treeZ, int height, Vector3I* coords, BlockRaw* blocks);
#endif
